
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
  
  #badgeModal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex !important;
    align-items: center;
    justify-content: center;
    z-index: 1050;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    background: rgba(0, 0, 0, 0.4);
    /* backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px); */
  }
  
  #badgeModal.show {
    opacity: 1;
    visibility: visible;
  }
  
  #badgeModal .modal-dialog {
    margin: 1rem;
    max-width: 440px;
    width: 100%;
    transform: translateY(20px) scale(0.98);
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    opacity: 0;
  }
  
  #badgeModal.show .modal-dialog {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
  
  @keyframes pulse {
    0% { transform: scale(1); opacity: 0.3; }
    100% { transform: scale(1.1); opacity: 0.6; }
  }
  
  @keyframes float {
    0%, 100% { transform: translate(-50%, -50%) scale(1); }
    50% { transform: translate(-50%, -55%) scale(1.05); }
  }
  
  #badgeModal .modal-content {
    border: none;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    overflow: hidden;
    background: var(--color9);
    border: 1px solid rgba(255, 107, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    position: relative;
    z-index: 1;
    /* background: linear-gradient(135deg, #fffbf8 0%, #fff 100%); */
  }
  
  #badgeModal .modal-content::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
   /* radial-gradient(circle at center, rgba(255, 107, 0, 0.1) 0%, rgba(255, 107, 0, 0) 60%); */
    z-index: -1;
    opacity: 0.5;
    animation: pulse 6s infinite alternate;
    pointer-events: none;
  }
  
  #badgeModal .modal-header {
    display: none;
  }
  
  #badgeModal .modal-title {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-weight: 700;
    color: #1a1a1a;
    font-size: 1.5rem;
    margin: 0;
    letter-spacing: -0.02em;
    background: linear-gradient(90deg, var(--color2) 0%, var(--color3) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    position: relative;
    display: inline-block;
  }
  
  
  
  #badgeModal .modal-body {
    padding: 1.5rem 2rem 2rem;
    text-align: center;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }
  
  #badgeModal .modal-body h4 {
    color: #1a1a1a;
    font-weight: 400;
    font-size: 1.25rem;
    margin: 1.25rem 0 0.75rem;
    letter-spacing: -0.01em;
  }
  
  #badgeModal .modal-body p {
    color: #666;
    font-size: 0.95rem;
    line-height: 1.6;
    max-width: 320px;
    margin: 0 auto 1.5rem;
    font-weight: 400;
  }
  
  #badgeModal .badge-icon-container {
    margin: 0 auto 1.5rem;
    max-width: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1.5rem;
    position: relative;
    z-index: 1;
  }

  #badgeModal .badge-icon-container::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 200px;
    height: 200px;
    background: radial-gradient(circle at center, 
      rgba(255, 145, 0, 0.2) 0%, 
      rgba(255, 145, 0, 0.1) 40%, 
      rgba(255, 145, 0, 0) 70%);
    border-radius: 50%;
    z-index: -1;
    animation: float 6s ease-in-out infinite;
    /* filter: blur(10px); */
  }
  
  #badgeIcon {
    filter: drop-shadow(0 4px 15px rgba(255, 107, 0, 0.3));
    transition: transform 0.3s ease;
  }
  
  #badgeIcon:hover {
    transform: scale(1.05) rotate(5deg);
  }
  
  #badgeModal .btn-close-custom {
    position: absolute;
    right: 1.25rem;
    top: 1.25rem;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.05);
    border: none;
    border-radius: 8px;
    padding: 0;
    cursor: pointer;
    color: #666;
    transition: all 0.2s ease;
    opacity: 0.8;
  }
  
  #badgeModal .btn-close-custom:hover {
    background: rgba(0, 0, 0, 0.08);
    color: #333;
    opacity: 1;
    transform: rotate(90deg);
  }
  
  #badgeModal .btn-close-custom svg {
    width: 16px;
    height: 16px;
  }
  
  .btn-continue {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    background: linear-gradient(90deg, #ff6b00 0%, #ff8a3d 100%);
    color: white;
    border: none;
    padding: 0.75rem 1.75rem;
    border-radius: 50px;
    font-family: 'Inter', sans-serif;
    font-weight: 600;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

    position: relative;
    overflow: hidden;
  }
  
  .btn-continue::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
      rgba(255, 255, 255, 0) 0%, 
      rgba(255, 255, 255, 0.2) 50%, 
      rgba(255, 255, 255, 0) 100%);
    transition: all 0.6s ease;
  }
  
  .btn-continue:hover {
    transform: translateY(-2px);

  }
  
  .btn-continue:active {
    transform: translateY(0);

  }
  
  .btn-continue:hover::before {
    left: 100%;
  }
  
  .btn-continue svg {
    transition: transform 0.3s ease;
  }
  
  .btn-continue:hover svg {
    transform: translateX(3px);
  }
</style>
  
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
<div class="modal fade" id="badgeModal" tabindex="-1" aria-labelledby="badgeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body text-center p-4 position-relative">
       
        <div class="d-flex flex-column align-items-center">
          <div class="text-center mb-4">
            <h5 class="modal-title badge-title">
              New Badge Earned!
            </h5>
            <h4 id="badgeName" style="font-family: 'Fira Code', monospace; color: var(--color4); font-weight: 600; letter-spacing: -0.5px; font-size: 1.25rem;">
              Badge Name
            </h4>
          </div>
          
          <div class="my-4">
            <img id="badgeImage" src="" alt="Badge" style="width: 150px;">
          </div>
          
          <p id="badgeDescription" style="font-family: 'Fira Code', monospace; color: var(--color3); font-size: 1rem; line-height: 1.5; max-width: 80%; margin: 0 auto; margin-top: 20px; margin-bottom: 20px;">
            description
          </p>
          
          <button type="button" class="btn-continue d-inline-flex align-items-center gap-2 px-4 py-2" data-bs-dismiss="modal" style="background: linear-gradient(135deg, var(--color3) 0%, var(--color2) 100%); border: none; border-radius: 50px; color: white; font-weight: 500; transition: all 0.3s ease;">
            <span>Got it!</span>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
      </div>
    </div>
  </div>
</div>

<script>
function showBadgeModal(badgeData) {
    const modal = new bootstrap.Modal(document.getElementById('badgeModal'));
    
    if (badgeData) {
      if (badgeData.icon_url) {
          const badgeImage = document.getElementById('badgeImage');
          const currentTheme = document.documentElement.getAttribute('data-theme') || 'orange'; 
          console.log(currentTheme);
          const themedIconUrl = badgeData.icon_url.replace(
              '/themes/orange/',
              `/themes/${currentTheme}/`
          );
          
          badgeImage.src = themedIconUrl;
      }
      if (badgeData.name) {
          document.getElementById('badgeName').textContent = badgeData.name;
      }
      if (badgeData.description) {
          document.getElementById('badgeDescription').textContent = badgeData.description;
      }
      modal.show();
    }
    
    
}
const badgeTitle = document.getElementById('badgeTitle');
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.badge-img-small:not(.badge-unobtained)').forEach(badgeImg => {
        badgeImg.style.cursor = 'pointer';
        badgeImg.addEventListener('click', function() {
            const badgeCard = this.closest('.badge-card');
            if (badgeCard) {
                const tooltip = badgeCard.querySelector('.badge-tooltip')?.textContent || '';
                const badgeData = {
                    icon_url: this.src,
                    name: this.alt,
                    description: this.dataset.description,
                    tooltip: tooltip
                };
                showBadgeModal(badgeData);
                document.querySelector('.badge-title').textContent = "New Badge Earned!";
            }
        });
    });
    document.querySelectorAll('.badge-img-small.badge-unobtained').forEach(badgeImg => {
        badgeImg.style.cursor = 'pointer';
        badgeImg.addEventListener('click', async function() {
            const badgeCard = this.closest('.badge-card');
            if (badgeCard) {
              const tooltip = badgeCard.querySelector('.badge-tooltip')?.textContent || '';
              const badgeType = this.dataset.badgeType; 
              const requiredCount = parseInt(this.dataset.requiredCount) || 0;
              const badgeName = this.alt;
              
              try {
                const response = await fetch('/api/user/badges/data');
                const userData = await response.json();
                  
                let currentCount = 0;
                let progressText = '';
                switch(badgeType) {
                  case 'program':
                    currentCount = userData.program_count || 0;
                    progressText = `program${requiredCount - currentCount !== 1 ? 's': ''}`;
                    break;
                  case 'upvote':
                    currentCount = userData.upvote_count || 0;
                    progressText = `upvote${requiredCount - currentCount !== 1 ? 's' : ''}`;
                    break;
                  case 'comment':
                    currentCount = userData.comment_count || 0;
                    progressText = `comment${requiredCount - currentCount !== 1 ? 's' : ''}`;
                    break;
                }
                console.log('Counts:', {
                  currentCount: currentCount,
                  requiredCount: requiredCount,
                  remaining: requiredCount - currentCount
                });
                const remaining = Math.max(0, requiredCount-currentCount);
                const description = remaining>0 ? `You need ${remaining} more ${progressText} to earn this badge.` : 'You have earned this badge!';
                const badgeData = {
                  icon_url: this.src,
                  name: this.alt,
                  description: description,
                  tooltip: tooltip
                };
                showBadgeModal(badgeData);
                document.querySelector('.badge-title').textContent = "Unobtained Badge";
              } catch (error) {
                // fallback default
                console.error('Error fetching user data:', error);

                const badgeData = {
                    icon_url: this.src,
                    name: badgeName,
                    description: `Earn this badge by completing the requirements.`,
                    tooltip: tooltip
                };
                showBadgeModal(badgeData);
              }
            }
        });
    });
    
    // old before 3.1.0, refer to updates.txt
    // const badgeData = sessionStorage.getItem('newBadge');
    // if (badgeData) {
    //     try {
    //         const badge = JSON.parse(badgeData);
    //         showBadgeModal(badge);
    //         sessionStorage.removeItem('newBadge');
    //     } catch (e) {
    //         console.error('Error: ', e);
    //     }
    // }
});

</script>