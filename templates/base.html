<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}MakeCore{% endblock %}</title>

    <meta name="description" content="Discover and share games built with MakeCode Arcade and Scratch!">
    <meta name="keywords" content="MakeCode, Scratch, games, student projects, arcade, share, makecore, block coding">
    
    <meta property="og:title" content="MakeCore" />
    <meta property="og:description" content="Discover and share games built with MakeCode Arcade and Scratch!" />
    <meta property="og:url" content="https://makecore.org" />
    <meta property="og:image" content="https://makecore.org/static/themes/orange/img/open_graph.png" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="MakeCore" />
    <meta property="og:locale" content="en_US" />

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="MakeCore">
    <meta name="twitter:description" content="Discover and share games built with MakeCode Arcade and Scratch!">
    <meta name="twitter:image" content="https://makecore.org/static/themes/orange/img/open_graph.png">

    <link rel="stylesheet" href="/static/css/colors.css">
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/toast.css">
    
    <link id="theme-favicon" rel="icon" href="/static/themes/orange/img/logo.svg" type="image/svg+xml" />
    {% block head %}{% endblock %}
    <link rel="stylesheet" href="/static/css/navbar.css"> 
    
    <meta name="csrf-token" content="{{ csrf_token() if csrf_token else '' }}">
    
    <!-- Uncomment to add Ads back again -->
    <!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7800212377232311"
    crossorigin="anonymous"></script> -->
</head>
<body>
    <div class="toast-container"></div>
  
    {% block navbar %}
      {% include "navbar.html" %}
    {% endblock %}
    <!-- {% if session['user'] and not current_page %}
      <style id="bg-no-arrows-style">
        html[data-theme="orange"] body {
            background-image: url('/static/themes/orange/img/bg_no_arrows.svg') !important;
        }
        html[data-theme="green"] body {
            background-image: url('/static/themes/green/img/bg_no_arrows.svg') !important;
        }
        html[data-theme="blue"] body {
            background-image: url('/static/themes/blue/img/bg_no_arrows.svg') !important;
        }
      </style>
    {% endif %}
    {% if session['user'] and not current_page %}
      <div id="left-ad" style="position: fixed; margin-right: 5px; transition: top 0.2s ease;">
        <ins class="adsbygoogle"
              style="display:inline-block;width:130px;height:600px;background-color:red;"
              data-ad-client="ca-pub-7800212377232311"
              data-ad-slot="6290107338"></ins>
        <script>
              (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      </div>

      <div id="right-ad" style="position: fixed; right:0; margin-left: 5px; transition: top 0.2s ease;">
        <ins class="adsbygoogle"
            style="display:inline-block;width:130px;height:600px; background-color: red;"
            data-ad-client="ca-pub-7800212377232311"
            data-ad-slot="9980303857"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      </div>
    {% endif %} -->

    <!-- <script>
        document.addEventListener('DOMContentLoaded', function() {
          updateAdPosition();
        });
        function updateAdPosition() {
            const leftAd = document.getElementById('left-ad');
            const rightAd = document.getElementById('right-ad');
            if(!leftAd || !rightAd) return;
            const scrollPosition = window.scrollY;
            const viewportHeight = window.innerHeight;
            const navbarOffset = 35;
            
            if (scrollPosition <= navbarOffset) {
                const adHeight = leftAd.offsetHeight;
                const viewportHeight = window.innerHeight;
                const centerTop = (viewportHeight - adHeight) / 2 + navbarOffset;

                leftAd.style.top = centerTop + 'px';
                leftAd.style.transform = 'none'; 
                rightAd.style.top = centerTop + 'px';
                rightAd.style.transform = 'none'; 
            } else {
                leftAd.style.top = '50%';
                leftAd.style.transform = 'translateY(-50%)';
                rightAd.style.top = '50%';
                rightAd.style.transform = 'translateY(-50%)';
            }
        }
        window.addEventListener('load', updateAdPosition);
        window.addEventListener('scroll', updateAdPosition);
        window.addEventListener('resize', updateAdPosition);
        
    </script> -->
        
    

    <div id="main-content">
      {% block content %}{% endblock %}
    </div>
      
    <div>
      {% include "modals/badge_modal.html" %}
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
    <script src="/static/js/toast.js" defer></script>

    {% if get_flashed_messages() %}
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      if (typeof window.showToast === 'function') {
        {% for category, message in get_flashed_messages(with_categories=true) %}
          {% if message is string %}
            window.showToast('{{ message|safe }}', '', '{{ category }}');
          {% else %}
            window.showToast('{{ message[0]|safe }}', '{{ message[1]|default("")|safe }}', '{{ category }}');
          {% endif %}
        {% endfor %}
      } else {
        console.error('showToast function not found');
      }
    });
    </script>
    {% endif %}
    {% block scripts %}{% endblock %}

    
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
    const newBadge = sessionStorage.getItem('newBadge');
    
    if (newBadge) {
        try {
            const badgeData = JSON.parse(newBadge);
            
            if (typeof showBadgeModal === 'function') {
                setTimeout(() => {
                    showBadgeModal(badgeData);
                    sessionStorage.removeItem('newBadge');
                    
                    fetch('/clear_new_badge', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        credentials: 'same-origin'
                    }).catch(error => {
                        console.error('Error clearing badge from session:', error);
                    });
                }, 1000); 
            }
        } catch (e) {
            console.error('Error showing badge modal:', e);
            sessionStorage.removeItem('newBadge');
        }
    }
});
</script>

</body>
</html>

<script>

  function updateThemeImages() {
    const theme = document.documentElement.getAttribute('data-theme') || 'orange';
    const favicon = document.getElementById('theme-favicon');
    if (favicon) {
        favicon.href = `/static/themes/${theme}/img/logo.svg`;
    }
    document.querySelectorAll('img[data-theme-src]').forEach(img => {
        const originalSrc = img.getAttribute('data-theme-src');
        
        img.src = originalSrc.replace(/\/themes\/[^/]+\//, `/themes/${theme}/`);
    });
  }
  function setTheme(themeName) {
    document.documentElement.setAttribute('data-theme', themeName);
    
    localStorage.setItem('theme', themeName);
    
    updateThemeImages();
  }
  
 
  setTheme(localStorage.getItem('theme') || 'orange');
</script>


<!-- <script>
  function updateBackgroundForAds(showAds) {
    const style = document.getElementById('bg-no-arrows-style');
    if (!style) return;

    if (showAds) {
        style.disabled = false;  // show the background when ads are on
    } else {
        style.disabled = true;   // hide the background when ads are off
    }
  }

  function updateAdsDisplay(show) {
      const leftAd = document.getElementById('left-ad');
      const rightAd = document.getElementById('right-ad');
  
      if (!leftAd || !rightAd) return;
  
      leftAd.style.display = show ? 'block' : 'none';
      rightAd.style.display = show ? 'block' : 'none';
  }
  
  document.addEventListener('DOMContentLoaded', () => {
      const showAdsServer = {{ 'true' if show_ads else 'false' }};
      updateBackgroundForAds(showAdsServer);
      updateAdsDisplay(showAdsServer);
  });
</script> -->
  